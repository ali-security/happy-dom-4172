{
  "cve_id": "CVE-2025-61927",
  "vulnerability_description": "Remote Code Execution (RCE) vulnerability in Happy DOM v19 and lower where Node.js VM Context is not isolated, allowing untrusted JavaScript code to escape the VM and access process-level functionality",
  "target_version": "18.0.1",
  "patch_status": "successfully_applied",
  "security_fix_summary": "Disabled JavaScript evaluation by default and added VM-level code generation restrictions to prevent untrusted code from escaping the VM context",
  "modified_files": [
    {
      "path": "packages/happy-dom/src/PropertySymbol.ts",
      "change_type": "modified",
      "description": "Added 'disableEvaluation' symbol for tracking process-level code generation restrictions",
      "lines_added": 1,
      "lines_removed": 0
    },
    {
      "path": "packages/happy-dom/src/browser/types/IBrowserSettings.ts",
      "change_type": "modified",
      "description": "Added enableJavaScriptEvaluation (default: false), deprecated disableJavaScriptEvaluation, and added suppressCodeGenerationFromStringsWarning setting",
      "lines_added": 23,
      "lines_removed": 2,
      "security_impact": "HIGH - Changes default behavior to disable JavaScript evaluation by default"
    },
    {
      "path": "packages/happy-dom/src/browser/DefaultBrowserSettings.ts",
      "change_type": "modified",
      "description": "Updated default settings to disable JavaScript evaluation by default (enableJavaScriptEvaluation: false)",
      "lines_added": 3,
      "lines_removed": 1,
      "security_impact": "HIGH - Secures the default configuration"
    },
    {
      "path": "packages/happy-dom/src/window/BrowserWindow.ts",
      "change_type": "modified",
      "description": "Updated setupVMContext to pass codeGeneration options to VM.createContext with strings disabled by default, added warning when process-level restrictions are bypassed",
      "lines_added": 24,
      "lines_removed": 6,
      "security_impact": "CRITICAL - Implements VM-level code generation restrictions to prevent eval() and Function constructor exploitation"
    },
    {
      "path": "packages/happy-dom/src/nodes/html-script-element/HTMLScriptElement.ts",
      "change_type": "modified",
      "description": "Updated script evaluation logic to respect enableJavaScriptEvaluation setting in inline scripts and module loading",
      "lines_added": 12,
      "lines_removed": 6,
      "security_impact": "HIGH - Prevents inline script execution when evaluation is disabled"
    },
    {
      "path": "packages/happy-dom/test/nodes/html-script-element/HTMLScriptElement.test.ts",
      "change_type": "modified",
      "description": "Updated test setup to enable JavaScript evaluation for tests that require script execution",
      "lines_added": 1,
      "lines_removed": 1,
      "security_impact": "NONE - Test compatibility"
    },
    {
      "path": "packages/happy-dom/test/window/DetachedWindowAPI.test.ts",
      "change_type": "modified",
      "description": "Updated tests to use enableJavaScriptEvaluation instead of deprecated disableJavaScriptEvaluation",
      "lines_added": 4,
      "lines_removed": 4,
      "security_impact": "NONE - Test compatibility"
    },
    {
      "path": "packages/happy-dom/test/nodes/document/Document.test.ts",
      "change_type": "modified",
      "description": "Updated test setup to enable JavaScript evaluation",
      "lines_added": 1,
      "lines_removed": 1,
      "security_impact": "NONE - Test compatibility"
    },
    {
      "path": "packages/happy-dom/test/window/BrowserWindow.test.ts",
      "change_type": "modified",
      "description": "Updated test setup to enable JavaScript evaluation",
      "lines_added": 1,
      "lines_removed": 1,
      "security_impact": "NONE - Test compatibility"
    },
    {
      "path": "packages/happy-dom/test/window/Window.test.ts",
      "change_type": "modified",
      "description": "Updated test setup to enable JavaScript evaluation",
      "lines_added": 1,
      "lines_removed": 1,
      "security_impact": "NONE - Test compatibility"
    },
    {
      "path": "packages/happy-dom/test/window/GlobalWindow.test.ts",
      "change_type": "modified",
      "description": "Updated test setup to enable JavaScript evaluation for eval() tests",
      "lines_added": 1,
      "lines_removed": 1,
      "security_impact": "NONE - Test compatibility"
    }
  ],
  "total_files_modified": 11,
  "total_lines_added": 72,
  "total_lines_removed": 24,
  "breaking_changes": [
    {
      "description": "JavaScript evaluation (eval, Function constructor, etc.) is now disabled by default",
      "impact": "Applications that rely on eval() or dynamic code generation will need to explicitly set enableJavaScriptEvaluation: true in browser settings",
      "mitigation": "Set { settings: { enableJavaScriptEvaluation: true } } when creating a Browser or Window instance if dynamic code execution is required"
    },
    {
      "description": "The disableJavaScriptEvaluation setting is deprecated",
      "impact": "Code using disableJavaScriptEvaluation will still work but should migrate to enableJavaScriptEvaluation",
      "mitigation": "Replace disableJavaScriptEvaluation: false with enableJavaScriptEvaluation: true and disableJavaScriptEvaluation: true with enableJavaScriptEvaluation: false"
    }
  ],
  "security_improvements": [
    "VM Context now enforces code generation restrictions by default",
    "eval() and Function constructor are disabled unless explicitly enabled",
    "Warning logged when process-level restrictions are bypassed",
    "Inline script execution respects the new security settings",
    "Module loading respects the new security settings"
  ],
  "testing_recommendations": [
    "Run full test suite to ensure compatibility",
    "Test applications that use eval() or Function constructor with enableJavaScriptEvaluation: true",
    "Verify that untrusted code cannot escape VM context when evaluation is disabled",
    "Test script element behavior with default settings (evaluation disabled)",
    "Verify backward compatibility with disableJavaScriptEvaluation (deprecated) setting"
  ],
  "notes": [
    "This backport focuses specifically on fixing CVE-2025-61927 (VM escape via code generation)",
    "The patch changes the default security posture to be more secure by default",
    "Applications requiring dynamic code execution must explicitly opt-in",
    "The patch is backward compatible through the deprecated disableJavaScriptEvaluation setting",
    "Process-level protection via --disallow-code-generation-from-strings flag is recommended but not enforced",
    "Test files were updated to explicitly enable JavaScript evaluation where needed"
  ],
  "vulnerability_fixed": true,
  "additional_vulnerabilities_found": false
}
